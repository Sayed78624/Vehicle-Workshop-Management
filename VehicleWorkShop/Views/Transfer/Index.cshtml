@model List<VehicleWorkShop.ViewModels.TransferVM>

<div class="container mt-4">
    @if (TempData["Success"] != null)
    {
        <div id="successAlert" class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div id="errorAlert" class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary"><i class="bi bi-list-ul me-2"></i>Transfer List</h2>
        <a asp-action="Create" class="btn btn-outline-primary rounded-pill shadow-sm">
            <i class="bi bi-plus-circle me-1"></i> Create Transfer
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle shadow-sm">
            <thead class="table-light">
                <tr>
                    <th scope="col">SL</th>
                    <th scope="col">Description</th>
                    <th scope="col">Is Approved</th>
                    <th scope="col">Details</th>
                    <th scope="col">Approve</th>
                    <th scope="col">Actions</th>
                    <th>Generate Invoice</th>
                   
                </tr>
            </thead>
            <tbody>
                @foreach (var transfer in Model)
                {
                    <tr>
                        <td>@transfer.Tran_Id</td>
                        <td>@transfer.Description</td>
                        <td>
                            @if (transfer.IsApprove)
                            {
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Yes</span>
                            }
                            else
                            {
                                <span class="badge bg-danger"><i class="bi bi-x-circle me-1"></i>No</span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-sm btn-outline-info"
                                    data-bs-toggle="modal"
                                    data-bs-target="#detailsModal@transfer.Tran_Id">
                                <i class="bi bi-eye"></i> View
                            </button>
                        </td>

                        <td>
                            @if (!transfer.IsApprove) 
                            {
                                <a asp-action="Approve" asp-route-id="@transfer.Tran_Id" class="btn btn-sm btn-outline-success"
                                   onclick="return confirm('Are you sure you want to approve this transfer?');">
                                    <i class="bi bi-check-circle me-1"></i> Approve
                                </a>
                            }
                            else 
                            {
                                <span class="badge bg-success">
                                    <i class="bi bi-check2-circle me-1"></i>Already Approved
                                </span>
                            }
                        </td>
                        <td>
                            <form asp-action="Delete" asp-route-id="@transfer.Tran_Id" method="post" onsubmit="return confirm('Are you sure you want to delete this transfer?');">
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </form>
                        </td>
                        <td>
                            <a asp-action="Invoice" asp-route-id="@transfer.Tran_Id"class="btn btn-info">View Invoice</a>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>

    @foreach (var transfer in Model)
    {
        <div class="modal fade" id="detailsModal@transfer.Tran_Id" tabindex="-1" aria-labelledby="detailsModalLabel@transfer.Tran_Id" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content shadow">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="detailsModalLabel@transfer.Tran_Id">
                            Transfer Details - #@transfer.Tran_Id
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        @if (transfer.Details != null && transfer.Details.Any())
                        {
                            <table class="table table-bordered table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Product</th>
                                        <th>Qty</th>
                                        <th>Source Store</th>
                                        <th>Destination Store</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var detail in transfer.Details)
                                    {
                                        <tr>
                                            <td>@detail.ProductName</td>
                                            <td>@detail.Quantity</td>
                                            <td>@detail.SourceStoreName</td>
                                            <td>@detail.DestinationStoreName</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                        else
                        {
                            <p class="text-muted">No details available.</p>
                        }
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@* @section Scripts { *@
@*     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> *@
@* } *@
@section Scripts {
    <script >
        // Auto hide after 4 seconds
        setTimeout(function () {
            var success = document.getElementById("successAlert");
            if (success) {
                success.style.display = "none";
            }

            var error = document.getElementById("errorAlert");
            if (error) {
                error.style.display = "none";
            }
        }, 4000); // 4000 milliseconds = 4 seconds
    </script>
}