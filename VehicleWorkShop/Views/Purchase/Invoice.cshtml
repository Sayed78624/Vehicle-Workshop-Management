@model VehicleWorkShop.ViewModels.SaleInvoice

@{
    bool isPdf = ViewData["From"]?.ToString() == "pdf";
    Layout = isPdf ? null : "_Layout";
    ViewData["Title"] = "Sale Invoice";
}

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
        color: #212529;
    }

    .invoice-container {
        padding: 30px 40px;
        max-width: 900px;
        margin: 20px auto;
        border: 1px solid #dee2e6;
        background: #fff;
        border-radius: @(isPdf ? "0" : "12px");
        box-shadow: @(isPdf ? "none" : "0 0 15px rgba(0,0,0,0.1)");
    }

    .invoice-header, .invoice-footer {
        border-bottom: 2px solid #dee2e6;
        margin-bottom: 20px;
        padding-bottom: 15px;
    }

    .invoice-footer {
        border-top: 2px solid #dee2e6;
        border-bottom: none;
        margin-top: 30px;
        padding-top: 15px;
    }

    .invoice-table th {
        background-color: #343a40;
        color: #fff;
        vertical-align: middle;
    }

    .invoice-table td, .invoice-table th {
        vertical-align: middle !important;
    }

    .totals-box {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        font-weight: 600;
    }
</style>

<div class="invoice-container">
    <!-- Header -->
    <div class="invoice-header d-flex justify-content-between align-items-center">
        <div>
            <h2 class="text-primary fw-bold mb-1">@Model.WorkshopName</h2>
            <p class="mb-0 text-muted">123 Garage Road, Dhaka, Bangladesh</p>
            <p class="mb-0 text-muted">Phone: +880 1234 567890</p>
            <p class="mb-0 text-muted">Email: info@autocare.com</p>
        </div>
        <div class="text-end">
            <h4 class="text-dark fw-semibold">INVOICE</h4>
            <p class="mb-1"><strong>Invoice No:</strong> @Model.InvoiceId</p>
            <p class="mb-1"><strong>Date:</strong> @DateTime.Now.ToString("dd MMM yyyy")</p>
        </div>
    </div>

    <!-- Customer Info -->
    <div class="row mb-4">
        <div class="col-md-6">
            <h5 class="fw-semibold text-secondary border-bottom pb-1 mb-3">Customer Info</h5>
            <p><strong>Name:</strong> @Model.CustomerName</p>
            <p><strong>Mobile:</strong> @Model.Mobile</p>
            <p><strong>Email:</strong> @Model.Email</p>
            <p><strong>Address:</strong> @Model.Address</p>
        </div>
    </div>

    <!-- Product Table -->
    <div class="table-responsive mb-4">
        <table class="table table-bordered table-sm invoice-table text-center align-middle">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Product</th>
                    <th>Model</th>
                    <th>Qty</th>
                    <th>Price (৳)</th>
                    <th>VAT (%)</th>
                    <th>Sub Total (৳)</th>
                    <th>Store</th>
                    <th>Workshop</th>
                    <th>Bay</th>
                    <th>Level</th>
                    <th>VIN</th>
                    <th>Reg. No</th>
                    <th>Start</th>
                    <th>End</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Details.Count; i++)
                {
                    var item = Model.Details[i];
                    <tr>
                        <td>@(i + 1)</td>
                        <td>@item.ProductName</td>
                        <td>@item.ModelName</td>
                        <td>@item.Quantity</td>
                        <td>@item.Price.ToString("0.00")</td>
                        <td>@item.Vat.ToString("0.00")</td>
                        <td>@item.SubTotal.ToString("0.00")</td>
                        <td>@item.StoreName</td>
                        <td>@item.WorkShopName</td>
                        <td>@item.BayId</td>
                        <td>@item.LevelId</td>
                        <td>@item.Vin</td>
                        <td>@item.RegisterNo</td>
                        <td>@item.StartTime.ToString(@"hh\:mm")</td>
                        <td>@item.EndTime.ToString(@"hh\:mm")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Totals -->
    <div class="row justify-content-end mb-4">
        <div class="col-md-4">
            <div class="totals-box text-end">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal</span>
                    <span>৳ @Model.Details.Sum(x => x.SubTotal).ToString("0.00")</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>VAT Total</span>
                    <span>৳ @Model.Details.Sum(x => x.Vat).ToString("0.00")</span>
                </div>
                <hr />
                <div class="d-flex justify-content-between">
                    <strong>Grand Total</strong>
                    <strong class="text-success">৳ @Model.GrandTotal.ToString("0.00")</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="mb-4">
        <strong>Notes:</strong>
        <p class="text-muted">
            Please verify all products and services. This invoice is computer generated and does not require physical signature.
        </p>
    </div>

    <!-- Signature Section -->
    <!-- Signature Section -->
    <table class="signature-table" style="width:100%; margin-top: 50px;">
        <tr>
            <td style="width: 30%; text-align: center;">
                <div style="border-top: 1px solid #000; width: 60%; margin: 0 auto 5px auto;"></div>
                <span style="font-weight: bold;">Authorized Signature</span>
            </td>
            <td style="width: 30%; text-align: center;">
                <div style="border-top: 1px solid #000; width: 60%; margin: 0 auto 5px auto;"></div>
                <span style="font-weight: bold;">Customer Signature</span>
            </td>
        </tr>
    </table>

    <!-- Buttons -->
    @if (!isPdf)
    {
        <div class="text-center mt-5">
            <button onclick="window.print()" class="btn btn-outline-dark me-2">🖨️ Print</button>
            <a asp-action="DownloadInvoice" asp-route-id="@Model.InvoiceId" class="btn btn-primary me-2">⬇️ Download PDF</a>
            <a asp-action="Index" class="btn btn-secondary">⬅️ Back to List</a>
        </div>
    }
</div>
